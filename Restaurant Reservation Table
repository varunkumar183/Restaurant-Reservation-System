import { useState } from "react";

function RestaurantReservation() {
    const [seatsLeft, setSeatsLeft] = useState(20);
    const [reservations, setReservations] = useState([]);
    
    const handleSubmit = (event) => {
        event.preventDefault();
        const name = event.target.name.value;
        const phone = event.target.phone.value;
        const guestCount = parseInt(event.target.guestCount.value);

        if (guestCount > seatsLeft) {
            alert("Not enough seats available!");
            return;
        }
        
        const checkInTime = new Date().toLocaleTimeString();
        setSeatsLeft(seatsLeft - guestCount);
        
        setReservations([...reservations, { name, phone, guestCount, checkInTime, checkoutTime: "-" }]);
        event.target.reset();
    };
    
    const handleCheckout = (name) => {
        setReservations(reservations.map(res => 
            res.name === name ? { ...res, checkoutTime: new Date().toLocaleTimeString() } : res
        ));
        const guestCount = reservations.find(res => res.name === name)?.guestCount || 0;
        setSeatsLeft(seatsLeft + guestCount);
    };
    
    const handleDelete = (name) => {
        const reservationToDelete = reservations.find(res => res.name === name);
        if (reservationToDelete && reservationToDelete.checkoutTime === "-") {
            setSeatsLeft(seatsLeft + reservationToDelete.guestCount);
        }
        setReservations(reservations.filter(res => res.name !== name));
    };

    return (
        <div className="container text-center max-w-xl mx-auto">
            <h2 className="text-xl font-bold">Restaurant Reservation System</h2>
            <p><strong>Seats Left:</strong> {seatsLeft}</p>
            <form onSubmit={handleSubmit} className="space-y-2">
                <input type="text" name="name" placeholder="Name" required className="border p-1" />
                <input type="text" name="phone" placeholder="Phone" required className="border p-1" />
                <input type="number" name="guestCount" placeholder="Guest Count" required className="border p-1" />
                <button type="submit" className="bg-blue-500 text-white px-3 py-1">Reserve</button>
            </form>
            <table className="w-full mt-4 border-collapse border border-gray-300">
                <thead>
                    <tr className="bg-gray-200">
                        <th className="border p-2">Name</th>
                        <th className="border p-2">Phone</th>
                        <th className="border p-2">Guest Count</th>
                        <th className="border p-2">Check-in Time</th>
                        <th className="border p-2">Checkout Time</th>
                        <th className="border p-2">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {reservations.map((res, index) => (
                        <tr key={index} className="border">
                            <td className="border p-2">{res.name}</td>
                            <td className="border p-2">{res.phone}</td>
                            <td className="border p-2">{res.guestCount}</td>
                            <td className="border p-2">{res.checkInTime}</td>
                            <td className="border p-2">{res.checkoutTime}</td>
                            <td className="border p-2">
                                <button onClick={() => handleCheckout(res.name)} className="bg-green-500 text-white px-2 py-1 mr-2">Checkout</button>
                                <button onClick={() => handleDelete(res.name)} className="bg-red-500 text-white px-2 py-1">Delete</button>
                            </td>
                        </tr>
                    ))}
                </tbody>
            </table>
        </div>
    );
}

export default RestaurantReservation;
